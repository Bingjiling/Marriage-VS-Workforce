---
title: "FES map"
author: "Group 7"
date: "February 1, 2016"
output: html_document
---
```{r}
library(mapproj)
library(dplyr)
library(gridExtra)
library(ggplot2)
library(RColorBrewer)
library(choroplethr)
library(choroplethrMaps)
library(splitstackshape)
```

```{r}
statenames <- read.csv("../data/statenames.csv", strip.white = TRUE)
statenames <- rename(statenames, ST = code, ST_name = name, ST_abbr = abbr)
hp <- readRDS("../data/hp.RDS")
hp <- tbl_df(hp)
hp <- left_join(hp, statenames)
hp_fes1to4 <- select(hp, SERIALNO, WGTP, FES, ST_name, ST_abbr) %>% 
              filter(FES >= 1 & FES <= 4) %>% 
              distinct(SERIALNO)
hp_fes1to4_wgtp <- expandRows(hp_fes1to4, "WGTP")
hp_fes1to4_state <- hp_fes1to4_wgtp %>% group_by(ST_name, FES) %>% 
                    summarise(FES_count = n()) %>% rename(region = ST_name)
hp_fes1to4_state_total <- hp_fes1to4_state %>% group_by(region) %>%
                          summarise(total_count = sum(FES_count))
total_count <- rep(hp_fes1to4_state_total$total_count, each = 4)
hp_fes1to4_state <- cbind(hp_fes1to4_state, total_count)
hp_fes1to4_state <- tbl_df(hp_fes1to4_state)
hp_fes1to4_state <- mutate(hp_fes1to4_state, value = FES_count / total_count)

hp_fes1_state <- filter(hp_fes1to4_state, FES == 1)
hp_fes2_state <- filter(hp_fes1to4_state, FES == 2)
hp_fes3_state <- filter(hp_fes1to4_state, FES == 3)
hp_fes4_state <- filter(hp_fes1to4_state, FES == 4)
```

```{r}
